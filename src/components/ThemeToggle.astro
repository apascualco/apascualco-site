---
const label = 'Toggle theme';
---

<button class="theme-toggle" aria-label={label} title={label}>
  <span class="sun">‚òÄÔ∏è</span>
  <span class="moon">üåô</span>
</button>

<style>
  .theme-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 33px;
    height: 33px;
    padding: 0;
    border: 1px solid var(--border-color);
    background: var(--background-highlight);
    color: var(--font);
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.15s ease;
    font-size: 1rem;
  }
  .theme-toggle:hover {
    background: var(--background-hover);
  }
  .theme-toggle .sun {
    display: none;
  }
  html[data-theme='light'] .theme-toggle .sun {
    display: inline;
  }
  html[data-theme='light'] .theme-toggle .moon {
    display: none;
  }

  @media (max-width: 560px) {
    .theme-toggle {
      width: 28px;
      height: 28px;
      font-size: 0.85rem;
    }
  }
</style>

<script>
  const STORAGE_KEY = 'theme';
  const root = document.documentElement;

  function applyTheme(theme) {
    if (theme === 'light') root.setAttribute('data-theme', 'light');
    else root.removeAttribute('data-theme');
    try {
      localStorage.setItem(STORAGE_KEY, theme);
    } catch {
      /* localStorage unavailable */
    }
  }

  (function init() {
    let saved = null;
    try {
      saved = localStorage.getItem(STORAGE_KEY);
    } catch {
      /* localStorage unavailable */
    }
    if (!saved) {
      const prefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
      saved = prefersLight ? 'light' : 'dark';
    }
    applyTheme(saved);
  })();

  const scope = document.currentScript?.parentElement || document;
  const btn = scope.querySelector('.theme-toggle');

  if (btn) {
    btn.addEventListener('click', () => {
      const isLight = root.getAttribute('data-theme') === 'light';
      applyTheme(isLight ? 'dark' : 'light');
    });
  }
</script>
