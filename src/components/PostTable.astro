---
import type { CollectionEntry } from "astro:content";

export interface Props {
  posts: CollectionEntry<"blog">[];
}

const { posts } = Astro.props;

function groupPostsByYear(posts: CollectionEntry<"blog">[]) {
  return posts.reduce(
    (acc, post) => {
      const year = new Date(post.data.pubDate).getFullYear();
      if (!acc[year]) acc[year] = [];
      acc[year].push(post);
      return acc;
    },
    {} as Record<number, CollectionEntry<"blog">[]>
  );
}

const groupedPosts = groupPostsByYear(posts);
---

<section>
  <div class="post-table">
    <div class="table-header">
      <span class="col-date"></span>
      <span class="col-title">título</span>
      <span class="col-title">subtitulo</span>
      <span class="col-views">tag</span>
    </div>

    {
      Object.entries(groupedPosts)
        .sort((a, b) => Number(b[0]) - Number(a[0]))
        .map(([year, posts]) =>
          posts.map((post, idx) => (
            <a href={`/blog/${post.id}/`} class="col-title post-title">
              <div class="table-row">
                <span class="col-date">{idx === 0 ? year : ""}</span>

                {post.data.title}

                <span>- {post.data.description}</span>
                <span class="col-topic">{post.data.topic ?? "—"}</span>
              </div>
            </a>
          ))
        )
    }
  </div>
</section>

<style>
  section {
    font-size: 14px;
  }

  .post-table {
    width: 100%;
    color: #e7e7e7;
  }

  .table-header {
    display: grid;
    grid-template-columns: 50px 120px 3fr 1fr;
    align-items: center;
    gap: 0.5rem;
    padding: 6px 0 10px 0;
    color: #8b8b8b;
    border-bottom: 1px solid #4d4c4c;
    text-transform: lowercase;
  }

  .table-row {
    display: grid;
    grid-template-columns: 50px 120px 3fr 1fr;
    align-items: center;
    gap: 0.5rem;
    padding: 15px 0;
    border-top: 1px solid #4d4c4c;
    transition: background-color 0.15s ease;
  }

  .table-row:last-child {
    border-bottom: 1px solid #4d4c4c;
  }

  .table-row:hover {
    background: #6b6b6b;
  }

  .post-title {
    text-decoration: none;
    color: inherit;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .col-date {
    text-align: center;
  }

  .col-date-string {
    color: #9ca3af;
  }

  .col-topic {
    color: #bdbdbd;
  }

  .table-row[data-indented="true"] {
    grid-template-columns: 0px 1fr 140px 90px;
    padding-left: 56px;
  }

  .table-row[data-indented="true"] .col-date {
    display: none;
  }

  @media (max-width: 780px) {
    .table-header,
    .table-row {
      grid-template-columns: 50px 1fr 130px 80px;
    }
    .table-row[data-indented="true"] {
      padding-left: 50px;
    }
  }

  @media (max-width: 560px) {
    .table-header,
    .table-row {
      grid-template-columns: 50px 1fr 90px;
    }
    .col-topic {
      display: none;
    }
    .table-row[data-indented="true"] {
      grid-template-columns: 0px 1fr 90px;
    }
  }
</style>
